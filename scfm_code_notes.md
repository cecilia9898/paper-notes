# ç½‘ç»œæ¨æ–­çš„åŸºç±»ï¼ˆBase Classes for Network Inferenceï¼‰

## ã€1ã€‘å¯¼å…¥ Python çš„æŠ½è±¡åŸºç±»ï¼ˆABCï¼‰æ¨¡å—

```python
from abc import ABC, abstractmethod
```

### **1. ä»€ä¹ˆæ˜¯ ABCï¼ˆæŠ½è±¡åŸºç±»ï¼‰ï¼Ÿ**
- **ABC çš„ä½œç”¨**ï¼šç¡®ä¿æ‰€æœ‰å­ç±» **å¿…é¡»** å®ç°ä½ è§„å®šçš„æ–¹æ³•ï¼ˆä½†å…·ä½“å®ç°å¯ä»¥ä¸åŒï¼‰ã€‚
- **å¦‚æœå­ç±»ä¸å®ç°è¿™äº›æ–¹æ³•ï¼ŒPython ä¼šç›´æ¥æŠ¥é”™**ï¼Œé˜²æ­¢ä½ åœ¨ä½¿ç”¨æ—¶å‡ºé”™ã€‚

---

### **2. ç°å®ä¸–ç•Œçš„ç±»æ¯”**
#### **å‡è®¾ä½ æ˜¯ä¸€å®¶é¤å…çš„è€æ¿**
ä½ ç»è¥ä¸€å®¶é¤å…ï¼Œæ‰€æœ‰å¨å¸ˆ **å¿…é¡»ä¼šåš**ï¼š
- ç‚’é¥­ ğŸš
- ç…®æ±¤ ğŸœ
- ç…ç‰›æ’ ğŸ¥©

ä½†ä¸åŒå¨å¸ˆçš„åšæ³•ä¸åŒï¼š
- **ä¸­é¤å¨å¸ˆ**ï¼šç”¨å¤§ç«çˆ†ç‚’åŠ é…±æ²¹ã€‚
- **æ³•å›½å¨å¸ˆ**ï¼šç”¨é»„æ²¹åŠ çº¢é…’ã€‚
- **å°åº¦å¨å¸ˆ**ï¼šåŠ å…¥å’–å–±å’Œé¦™æ–™ã€‚

å¦‚æœä½ ä¸å¼ºåˆ¶è¦æ±‚å¨å¸ˆåšè¿™ä¸‰é“èœï¼Œæœ‰çš„å¨å¸ˆå¯èƒ½åªä¼šç‚’é¥­ï¼Œä¸ä¼šç…ç‰›æ’ï¼Œå¯¼è‡´é¡¾å®¢ä¸æ»¡ã€‚

---

### **3. å¦‚æœæ²¡æœ‰â€œæ ‡å‡†æ¥å£â€ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ**
```python
class Chef:
    def cook_fried_rice(self):
        print("åšäº†ä¸€ä»½ç‚’é¥­")

    def cook_soup(self):
        print("åšäº†ä¸€é”…æ±¤")

# è¿™ä¸ªå¨å¸ˆä¸ä¼šç…ç‰›æ’ï¼
```
å½“ä½ è®©ä»–ç…ç‰›æ’ï¼š
```python
chef = Chef()
chef.cook_steak()  # âŒ æ–¹æ³•ä¸å­˜åœ¨ï¼Œä»£ç å´©æºƒï¼
```
ğŸ’¥ **ä½ çš„é¤å…è¦è¢«é¡¾å®¢æŠ•è¯‰äº†ï¼**

---

### **4. ä½¿ç”¨ ABC å¼ºåˆ¶æ‰€æœ‰å¨å¸ˆå®ç°ä¸‰é“èœ**
```python
from abc import ABC, abstractmethod

# è§„å®šï¼šæ‰€æœ‰å¨å¸ˆå¿…é¡»ä¼šåšè¿™ä¸‰é“èœ
class Chef(ABC):

    @abstractmethod
    def cook_fried_rice(self):
        pass  # å…·ä½“åšæ³•ç”±å­ç±»å†³å®š

    @abstractmethod
    def cook_soup(self):
        pass

    @abstractmethod
    def cook_steak(self):
        pass
```
è¿™æ—¶å€™ï¼Œ**å¦‚æœå¨å¸ˆå¿˜è®°å®ç° `cook_steak()`ï¼ŒPython ç›´æ¥æŠ¥é”™**ï¼

---

### **5. å…·ä½“å¨å¸ˆï¼ˆå­ç±»ï¼‰å®ç°è‡ªå·±çš„åšæ³•**
```python
class ChineseChef(Chef):
    def cook_fried_rice(self):
        print("ä¸­é¤å¨å¸ˆï¼šç”¨å¤§ç«çˆ†ç‚’ç‚’é¥­ï¼")

    def cook_soup(self):
        print("ä¸­é¤å¨å¸ˆï¼šç”¨éª¨å¤´ç…²æ±¤ï¼")

    def cook_steak(self):
        print("ä¸­é¤å¨å¸ˆï¼šç”¨é…±æ²¹å’Œè’œè“‰ç…ç‰›æ’ï¼")

class FrenchChef(Chef):
    def cook_fried_rice(self):
        print("æ³•å›½å¨å¸ˆï¼šåŠ é»„æ²¹ç‚’é¥­ï¼")

    def cook_soup(self):
        print("æ³•å›½å¨å¸ˆï¼šç…®ä¸€é”…æ³•å¼æ´‹è‘±æ±¤ï¼")

    def cook_steak(self):
        print("æ³•å›½å¨å¸ˆï¼šç”¨çº¢é…’é…±ç…ç‰›æ’ï¼")
```

---

### **6. æµ‹è¯•ä¸€ä¸‹**
```python
chinese_chef = ChineseChef()
chinese_chef.cook_fried_rice()  # ä¸­é¤å¨å¸ˆï¼šç”¨å¤§ç«çˆ†ç‚’ç‚’é¥­ï¼
chinese_chef.cook_soup()        # ä¸­é¤å¨å¸ˆï¼šç”¨éª¨å¤´ç…²æ±¤ï¼
chinese_chef.cook_steak()       # ä¸­é¤å¨å¸ˆï¼šç”¨é…±æ²¹å’Œè’œè“‰ç…ç‰›æ’ï¼

french_chef = FrenchChef()
french_chef.cook_fried_rice()  # æ³•å›½å¨å¸ˆï¼šåŠ é»„æ²¹ç‚’é¥­ï¼
french_chef.cook_soup()        # æ³•å›½å¨å¸ˆï¼šç…®ä¸€é”…æ³•å¼æ´‹è‘±æ±¤ï¼
french_chef.cook_steak()       # æ³•å›½å¨å¸ˆï¼šç”¨çº¢é…’é…±ç…ç‰›æ’ï¼
```

---

### **7. å¦‚æœå¨å¸ˆå°‘å­¦äº†ä¸€é“èœï¼ŒPython ç›´æ¥æŠ¥é”™**
```python
class BadChef(Chef):
    def cook_fried_rice(self):
        print("è¿™ä¸ªå¨å¸ˆä¼šåšç‚’é¥­")

    def cook_soup(self):
        print("è¿™ä¸ªå¨å¸ˆä¼šç…®æ±¤")

    # è¿™ä¸ªå¨å¸ˆå¿˜è®°äº† cook_steak æ–¹æ³•
```
åˆ›å»º `BadChef` å®ä¾‹ï¼š
```python
bad_chef = BadChef()
```
ğŸ’¥ **Python æŠ¥é”™**ï¼š
```
TypeError: Can't instantiate abstract class BadChef with abstract method cook_steak
```
**Python å‘ç° `BadChef` æ²¡æœ‰å®ç° `cook_steak()`ï¼Œæ‰€ä»¥ç›´æ¥æ‹’ç»åˆ›å»ºå¯¹è±¡ï¼**

---

### **8. å’Œä½ çš„ `base.py` ä»£ç çš„å¯¹åº”å…³ç³»**
ä½ çš„ `base.py` ä»£ç å®šä¹‰äº† `base(ABC)` ä½œä¸ºåŸºç±»ï¼š
```python
class base(ABC):
    @abstractmethod
    def _infer(self, d):
        pass  # è¿™é‡Œä¸æä¾›å…·ä½“å®ç°
```
ç„¶åï¼Œå…·ä½“çš„æ–¹æ³•ï¼ˆ`dag`, `lr`ï¼‰ç»§æ‰¿ `base` å¹¶å®ç° `_infer()`ï¼š
```python
class lr(base):
    def _infer(self, d):
        return d  # è¿™é‡Œæ˜¯çº¿æ€§å›å½’çš„æ¨æ–­é€»è¾‘
```
**è¿™å°±ç¡®ä¿äº†æ‰€æœ‰ç½‘ç»œæ¨æ–­æ–¹æ³•éƒ½æœ‰ `_infer()`ï¼Œä¸ä¼šæœ‰é—æ¼ï¼**

---

### **9. ç°å®ä¸–ç•Œ vs. Python ABC**
| ç°å®ä¸–ç•Œ           | Python ABC                       |
|--------------------|----------------------------------|
| ä½ æ˜¯é¤å…è€æ¿       | `ABC` æŠ½è±¡åŸºç±»                  |
| ä½ è§„å®šå¨å¸ˆå¿…é¡»ä¼šç‚’é¥­ã€ç…®æ±¤ã€ç…ç‰›æ’ | `@abstractmethod` è§„å®šæ‰€æœ‰å­ç±»å¿…é¡»æœ‰ `_infer()` |
| å…·ä½“æ€ä¹ˆç‚’é¥­ã€ç…ç‰›æ’ï¼Œæ¯ä¸ªå¨å¸ˆå¯ä»¥è‡ªå·±å†³å®š | å­ç±» (`dag`, `lr`) å¯ä»¥è‡ªå·±å®ç° `_infer()` |
| åªä¼šç‚’é¥­ä¸ä¼šç…ç‰›æ’çš„å¨å¸ˆä¸èƒ½ä¸Šå²— | å¦‚æœå­ç±»ç¼ºå°‘ `_infer()`ï¼ŒPython ç›´æ¥æŠ¥é”™ |

---

### **10. æ€»ç»“**
1. **ABC è®©æ‰€æœ‰å­ç±»éƒ½å¿…é¡»å®ç°æŸäº›æ–¹æ³•ï¼ˆå¦‚ `_infer()`ï¼‰ã€‚**
2. **å¦‚æœå­ç±»å¿˜è®°å®ç°ï¼ŒPython ä¼šç›´æ¥æŠ¥é”™ï¼Œé˜²æ­¢ç¨‹åºå´©æºƒã€‚**
3. **ä½†å­ç±»å¯ä»¥ç”¨è‡ªå·±çš„æ–¹å¼å®ç°æ–¹æ³•**ï¼ˆæ¯”å¦‚ä¸­é¤å¨å¸ˆ vs. æ³•å›½å¨å¸ˆï¼‰ã€‚
4. **è¿™æ ·ä½ å¯ä»¥æ”¾å¿ƒè®©è®¡ç®—æœºæ‰§è¡Œä½ çš„è§„åˆ™ï¼Œè€Œä¸æ€•ä»£ç é—æ¼å…³é”®æ–¹æ³•ï¼**

ğŸ¯ **ABC = ä½ æ˜¯è€æ¿ï¼Œè§„å®šå¿…é¡»åšå“ªäº›èœï¼Œä½†å…·ä½“æ€ä¹ˆåšå¯ä»¥éšæ„ï¼** ğŸš€

---

## ã€2ã€‘å®šä¹‰ç½‘ç»œæ¨æ–­çš„æŠ½è±¡åŸºç±» `base`

```python
# ä»ä¸Šä¸€çº§ç›®å½•çš„ backend æ¨¡å—å¯¼å…¥ base ä½œä¸º backend_base
from ..backend import base as backend_base

class base(ABC):
    """
    ç½‘ç»œæ¨æ–­çš„åŸºç±»ï¼Œæ‰€æœ‰å…·ä½“çš„ç½‘ç»œæ¨æ–­ç®—æ³•éƒ½åº”è¯¥ç»§æ‰¿è‡ªè¿™ä¸ªç±»
    """
    
    def __init__(self, backend: backend_base, docheck: bool = True, nth=1):
        """
        åˆå§‹åŒ–åŸºç±»
        
        å‚æ•°ï¼š
        backend: backend_base ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºè®¡ç®—åç«¯
        docheck: bool ç±»å‹ï¼Œæ˜¯å¦æ‰§è¡Œæ£€æŸ¥ï¼ˆé»˜è®¤ Trueï¼‰
        nth: int ç±»å‹ï¼Œä½¿ç”¨çš„ CPU çº¿ç¨‹æ•°é‡ï¼ˆé»˜è®¤ 1ï¼‰
        """
        self.docheck = docheck  # æ˜¯å¦æ‰§è¡Œæ•°æ®æ£€æŸ¥
        self.b = backend  # å­˜å‚¨è®¡ç®—åç«¯å®ä¾‹
        self.nth = nth  # è®¾å®šä½¿ç”¨çš„ CPU çº¿ç¨‹æ•°é‡

    @abstractmethod
    def _infer(self, d):
        """
        ä»æ•°æ®ä¸­æ¨æ–­ç½‘ç»œç»“æ„ï¼Œå…·ä½“æ–¹æ³•éœ€ç”±å­ç±»å®ç°
        
        å‚æ•°ï¼š
        d: çŸ©é˜µç±»å‹çš„æ•°æ®ï¼Œå…¶ä¸­ d[i, j] è¡¨ç¤ºæ ·æœ¬ i åœ¨èŠ‚ç‚¹ j çš„å€¼
        
        è¿”å›å€¼ï¼š
        inet:      ç½‘ç»œå¼ºåº¦çŸ©é˜µï¼Œè¡¨ç¤º i -> j çš„è¾¹çš„æƒé‡
        inetp:     P å€¼çŸ©é˜µï¼Œè¡¨ç¤º i -> j è¿™æ¡è¾¹çš„æ˜¾è‘—æ€§æ°´å¹³
        inetsigma: æ ‡å‡†è¯¯å·®çŸ©é˜µï¼Œè¡¨ç¤º i -> j è¿™æ¡è¾¹çš„ä¸ç¡®å®šæ€§
        """
        pass  # è¯¥æ–¹æ³•éœ€è¦åœ¨å­ç±»ä¸­å…·ä½“å®ç°ï¼ŒåŸºç±»ä¸­ä¸æä¾›å®ç°

    def check(self, d, ans):
        """
        è¿›è¡Œæ¨æ–­ç»“æœçš„åˆç†æ€§æ£€æŸ¥ï¼ˆSanity Checkï¼‰
        
        å‚æ•°ï¼š
        d: è¾“å…¥æ•°æ®ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªæ•°æ®çŸ©é˜µ
        ans: æœŸæœ›çš„æ­£ç¡®ç­”æ¡ˆï¼Œç”¨äºéªŒè¯æ¨æ–­ç»“æœçš„æ­£ç¡®æ€§
        
        ä½œç”¨ï¼š
        è¿™ä¸ªæ–¹æ³•å¯èƒ½ä¼šåœ¨å­ç±»ä¸­å®ç°ï¼Œç”¨äºå¯¹æ¨æ–­çš„ç½‘ç»œç»“æ„è¿›è¡Œè¯„ä¼°ã€‚
        """
        if len(ans) < 3:
            raise TypeError('Return must have length of at least 3.')  # ç¡®ä¿è¿”å›å€¼è‡³å°‘åŒ…å« 3 ä¸ªå…ƒç´ 
    
    def infer(self, d, *a, **ka):
        """
        æ‰§è¡Œç½‘ç»œæ¨æ–­ï¼Œå¹¶æ ¹æ®éœ€è¦æ‰§è¡Œæ£€æŸ¥ã€‚
        è¯¥æ–¹æ³•ä¸åº”è¢«å­ç±»é‡è½½ï¼Œè€Œåº”é‡è½½ `_infer` æ–¹æ³•ã€‚
        
        å‚æ•°ï¼š
        d: è¾“å…¥æ•°æ®çŸ©é˜µï¼Œå…¶ä¸­ d[i, j] ä»£è¡¨æ ·æœ¬ i åœ¨èŠ‚ç‚¹ j çš„å€¼ã€‚
        *a, **ka: ä¼ é€’ç»™ `_infer` æ–¹æ³•çš„å‚æ•°ã€‚
        
        è¿”å›å€¼ï¼š
        inet:  ç½‘ç»œå¼ºåº¦çŸ©é˜µï¼Œè¡¨ç¤º i -> j çš„è¾¹ã€‚
        inetp: P å€¼çŸ©é˜µï¼Œè¡¨ç¤º i -> j è¿™æ¡è¾¹çš„ç»Ÿè®¡æ˜¾è‘—æ€§ã€‚
        """
        ans = self._infer(d, *a, **ka)  # è°ƒç”¨ `_infer` è¿›è¡Œå®é™…æ¨æ–­
        if self.docheck:
            self.check(d, ans)  # æ‰§è¡Œæ£€æŸ¥
        return ans  # è¿”å›æ¨æ–­ç»“æœ
```

---

### **ç”¨æ•°å­¦å…¬å¼å’Œé€šä¿—æ–¹å¼è§£é‡Šè¿™äº›æ–¹æ³•**

#### **1. `__init__` æ–¹æ³•ï¼šåˆå§‹åŒ–ç½‘ç»œæ¨æ–­å™¨**
##### **æ•°å­¦è¡¨è¾¾**
å‡è®¾ï¼š
- $B$ æ˜¯è®¡ç®—åç«¯ï¼ˆbackendï¼‰ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªçŸ©é˜µè¿ç®—åº“ï¼ˆå¦‚ NumPy æˆ– TensorFlowï¼‰ã€‚
- $d$ æ˜¯è¾“å…¥æ•°æ®çŸ©é˜µï¼Œå…¶ä¸­ $d_{i,j}$ è¡¨ç¤º**æ ·æœ¬ $i$ åœ¨èŠ‚ç‚¹ $j$ çš„å€¼**ã€‚
- $n_{th}$ æ˜¯ä½¿ç”¨çš„ CPU çº¿ç¨‹æ•°ã€‚

åˆå§‹åŒ–è¿‡ç¨‹ï¼š
$$
\text{æ¨æ–­å™¨} = (B, \text{æ˜¯å¦æ£€æŸ¥}, n_{th})
$$

##### **é€šä¿—è§£é‡Š**
æŠŠ `__init__` æƒ³è±¡æˆï¼š
- ä½ è¦å»è·‘æ­¥ï¼ˆåšç½‘ç»œæ¨æ–­ï¼‰ï¼Œå…ˆ **æ¢ä¸Šè·‘é‹ï¼ˆbackendï¼‰**ï¼Œå†³å®š **è¦ä¸è¦çƒ­èº«ï¼ˆdocheckï¼‰**ï¼Œä»¥åŠ **æ‰¾å‡ ä¸ªäººé™ªä½ è·‘ï¼ˆnth çº¿ç¨‹æ•°ï¼‰**ã€‚

---

#### **2. `_infer(d)` æ–¹æ³•ï¼ˆæŠ½è±¡æ–¹æ³•ï¼‰**
##### **æ•°å­¦è¡¨è¾¾**
å‡è®¾ï¼š
- $d$ æ˜¯æ•°æ®çŸ©é˜µï¼Œå…¶ä¸­ $d_{i,j}$ è¡¨ç¤ºæ ·æœ¬ $i$ åœ¨èŠ‚ç‚¹ $j$ çš„å€¼ã€‚
- ç›®æ ‡æ˜¯æ¨æ–­å‡º **ç½‘ç»œè¿æ¥çŸ©é˜µ** $I$ã€‚

è¾“å‡ºï¼š
- $I_{\text{net}}$ï¼šç½‘ç»œå¼ºåº¦çŸ©é˜µï¼Œ$I_{i,j}$ è¡¨ç¤º **èŠ‚ç‚¹ $i$ æŒ‡å‘ $j$ çš„è¾¹å¼ºåº¦**ã€‚
- $I_{\text{p}}$ï¼šP å€¼çŸ©é˜µï¼Œè¡¨ç¤ºæ˜¾è‘—æ€§ã€‚
- $I_{\sigma}$ï¼šè¯¯å·®çŸ©é˜µï¼Œè¡¨ç¤ºä¸ç¡®å®šæ€§ã€‚

æ•°å­¦è¡¨ç¤ºï¼š
$$
\_infer(d) \rightarrow (I_{\text{net}}, I_{\text{p}}, I_{\sigma})
$$

##### **é€šä¿—è§£é‡Š**
æŠŠ `_infer()` æƒ³è±¡æˆï¼š
- ä½ æœ‰ä¸€å †ç¯®çƒæ¯”èµ›æ•°æ®ï¼ˆ$d$ï¼‰ã€‚
- ä½ è¦åˆ†æ **è°ä¼ çƒç»™è°æœ€å¤šï¼ˆ$I_{\text{net}}$ï¼‰**ï¼Œ**è¿™ä¸ªç»“æœæ˜¯ä¸æ˜¯å¶ç„¶ï¼ˆ$I_{\text{p}}$ï¼‰**ï¼Œä»¥åŠ **è¯¯å·®æœ‰å¤šå¤§ï¼ˆ$I_{\sigma}$ï¼‰**ã€‚
- ä½† **å…·ä½“åˆ†ææ–¹æ³•** ç”±å­ç±»å†³å®šï¼

---

#### **3. `check(d, ans)` æ–¹æ³•**
##### **æ•°å­¦è¡¨è¾¾**
è‹¥ `ans` æ˜¯ `_infer(d)` è¿”å›çš„å…ƒç»„ï¼š
$$
ans = (I_{\text{net}}, I_{\text{p}}, I_{\sigma})
$$
åˆ™ï¼š
$$
\text{len}(ans) \geq 3
$$

##### **é€šä¿—è§£é‡Š**
æŠŠ `check()` æƒ³è±¡æˆï¼š
- ä½ åšäº†ä¸€ä»½æ•°å­¦ä½œä¸šï¼ˆç½‘ç»œæ¨æ–­ï¼‰ã€‚
- äº¤ç»™è€å¸ˆæ£€æŸ¥ï¼š
  - **ç­”æ¡ˆæ•°é‡ä¸å¤Ÿ**ï¼Œè€å¸ˆä¼šè¯´ï¼šâ€œä½ æ²¡å†™å®Œæ•´ï¼â€
  - **æ ¼å¼ä¸å¯¹**ï¼Œè€å¸ˆç›´æ¥è®©ä½ é‡å†™ï¼

---

#### **4. `infer(d, *a, **ka)` æ–¹æ³•**
##### **æ•°å­¦è¡¨è¾¾**
æµç¨‹ï¼š
$$
ans = \_infer(d, *a, **ka)
$$
è‹¥ `docheck = True`ï¼š
$$
\text{check}(d, ans)
$$
è¿”å›ï¼š
$$
(I_{\text{net}}, I_{\text{p}}, I_{\sigma})
$$

##### **é€šä¿—è§£é‡Š**
æŠŠ `infer()` æƒ³è±¡æˆï¼š
- ä½ è€ƒè¯•ï¼ˆæ¨æ–­ï¼‰ã€‚
- å…ˆè‡ªå·±åšé¢˜ï¼ˆ`_infer(d)`ï¼‰ã€‚
- è‹¥è®¤çœŸç‚¹ï¼ˆ`docheck=True`ï¼‰ï¼Œæ‰¾åŒå­¦æ£€æŸ¥ï¼ˆ`check(d, ans)`ï¼‰ã€‚
- æœ€åäº¤å·ï¼ˆè¿”å› `ans`ï¼‰ã€‚

---

#### **5. æ€»ç»“è¡¨æ ¼**
| æ–¹æ³•         | æ•°å­¦è¡¨ç¤º                              | é€šä¿—è§£é‡Š                          |
|--------------|---------------------------------------|-----------------------------------|
| `__init__()` | $(B, \text{æ˜¯å¦æ£€æŸ¥}, n_{th})$       | æ¢è·‘é‹ï¼Œå†³å®šçƒ­èº«ï¼Œæ‰¾æœ‹å‹ä¸€èµ·è·‘ã€‚  |
| `_infer(d)`  | $d \rightarrow (I_{\text{net}}, I_{\text{p}}, I_{\sigma})$ | åˆ†æç¯®çƒæ•°æ®ï¼Œæ‰¾å‡ºä¼ çƒç½‘ç»œã€‚      |
| `check(d, ans)` | $\text{len}(ans) \geq 3$            | è€å¸ˆæ£€æŸ¥ä½œä¸šï¼Œçœ‹æœ‰æ²¡æœ‰å°‘å†™ã€‚      |
| `infer(d, *a, **ka)` | $ans = \_infer(d, *a, **ka)$        | è€ƒè¯•åæ£€æŸ¥å†äº¤å·ã€‚                |

---

#### **6. æ‰§è¡Œæµç¨‹**
è°ƒç”¨ `infer(d)` æ—¶ï¼š
1. **è°ƒç”¨ `_infer(d)`** â†’ è®¡ç®— $I_{\text{net}}, I_{\text{p}}, I_{\sigma}$ã€‚
2. **è‹¥ `docheck=True`ï¼Œè°ƒç”¨ `check(d, ans)`**ã€‚
3. **è¿”å› `ans`**ã€‚

---

#### **7. å¥½å¤„**
- **æ•°å­¦ä¸Š**ï¼šç¡®ä¿è¾“å‡ºä¸€è‡´ã€‚
- **ç¼–ç¨‹ä¸Š**ï¼šé¿å…é—æ¼ `_infer()`ã€‚
- **å¯ç»´æŠ¤æ€§**ï¼šä¾¿äºæ‰©å±•ã€‚

---

#### **8. å°ç»“**
- `_infer(d)`ï¼šæ ¸å¿ƒæ¨æ–­é€»è¾‘ï¼Œ$d \rightarrow (I_{\text{net}}, I_{\text{p}}, I_{\sigma})$ã€‚
- `check(d, ans)`ï¼šæ£€æŸ¥ç»“æœã€‚
- `infer(d)`ï¼šè‡ªåŠ¨åŒ–æµç¨‹ã€‚

---

## ã€3ã€‘å®šä¹‰ DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰æ¨æ–­åŸºç±»

```python
class dag(base):
    """
    ç”¨äº DAG ç»“æ„ç½‘ç»œæ¨æ–­çš„åŸºç±»ã€‚
    """
    
    def check(self, d, ans):
        """
        è¿›è¡Œ DAG ç»“æ„çš„åˆç†æ€§æ£€æŸ¥ã€‚
        
        å‚æ•°ï¼š
        d: è¾“å…¥æ•°æ®ã€‚
        ans: `_infer` æ–¹æ³•çš„è¿”å›ç»“æœã€‚
        
        æŠ›å‡ºå¼‚å¸¸ï¼š
        - å¦‚æœæ£€æµ‹åˆ°å¾ªç¯ä¾èµ–ï¼Œåˆ™æŠ›å‡º `RuntimeError`ã€‚
        """
        import numpy as np
        import networkx as nx
        
        super().check(d, ans)  # è°ƒç”¨çˆ¶ç±»çš„ `check` æ–¹æ³•
        
        for xi in [[ans[0], 0], [ans[1], 1], [ans[2], 0]]:
            if xi[0] is None:
                continue
            n1 = np.array([self.b.numpy(x) for x in self.b.nonzero(xi[0] != self.b.ones(xi[0].shape, dtype=xi[0].dtype) * xi[1])]).T
            n2 = nx.DiGraph()
            n2.add_edges_from(n1)
            try:
                nx.find_cycle(n2)  # æ£€æµ‹æ˜¯å¦å­˜åœ¨å¾ªç¯ä¾èµ–
                hascycle = True
            except nx.exception.NetworkXNoCycle:
                hascycle = False
            if hascycle:
                raise RuntimeError('Cycle found')  # å¦‚æœå‘ç°å¾ªç¯ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸
```

---

### **æ•°å­¦åŒ–è§£æ `check(self, d, ans)` æ–¹æ³•**

#### **1. DAG çš„æ•°å­¦å®šä¹‰**
æœ‰å‘å›¾ $G = (V, E)$ï¼š
- $V$ï¼šèŠ‚ç‚¹é›†åˆã€‚
- $E$ï¼šæœ‰å‘è¾¹é›†åˆã€‚

è‹¥æ— ç¯ï¼š
$$
\forall \text{è·¯å¾„ } v_1 \to v_2 \to ... \to v_k, \quad \text{ä¸å­˜åœ¨ } v_k \to v_1
$$

---

#### **2. è¾“å…¥**
- $d$ï¼šæ•°æ®çŸ©é˜µã€‚
- $ans = (I_{\text{net}}, I_{\text{p}}, I_{\sigma})$ã€‚

---

#### **3. è§£æ `for xi in [[ans[0], 0], [ans[1], 1], [ans[2], 0]]`**
éå†ï¼š
1. $I_{\text{net}}$ï¼ˆé˜ˆå€¼ 0ï¼‰ã€‚
2. $I_{\text{p}}$ï¼ˆé˜ˆå€¼ 1ï¼‰ã€‚
3. $I_{\sigma}$ï¼ˆé˜ˆå€¼ 0ï¼‰ã€‚

è‹¥ï¼š
$$
X_{i,j} \neq \text{é˜ˆå€¼} \Rightarrow i \to j
$$

---

#### **4. æ„å»ºæœ‰å‘å›¾ $G$**

```python
n1 = np.array([self.b.numpy(x) for x in self.b.nonzero(xi[0] != self.b.ones(xi[0].shape, dtype=xi[0].dtype) * xi[1])]).T
```
æ•°å­¦è¡¨ç¤ºï¼š
$$
E = \{(i, j) \mid X_{i,j} \neq \text{é˜ˆå€¼}\}
$$

```python
n2 = nx.DiGraph()
n2.add_edges_from(n1)
```
$$
G = (V, E)
$$

---

#### **5. æ£€æµ‹ç¯**
```python
try:
    nx.find_cycle(n2)
    hascycle = True
except nx.exception.NetworkXNoCycle:
    hascycle = False
```
$$
\exists v_1 \to v_2 \to ... \to v_k \to v_1 \Rightarrow \text{æŠ¥é”™}
$$

---

#### **6. æ€»ç»“**
1. ä» $I_{\text{net}}, I_{\text{p}}, I_{\sigma}$ æå–è¾¹ã€‚
2. ç”¨ `networkx` æ£€æµ‹ç¯ã€‚
3. è‹¥æ— ç¯ï¼Œåˆ™é€šè¿‡ã€‚

---

#### **7. ç±»æ¯”**
- å›¢é˜ŸæŒ‡æŒ¥é“¾æ£€æŸ¥ï¼šè‹¥ A â†’ B â†’ C â†’ Aï¼Œåˆ™æ··ä¹±ï¼

---

#### **8. å…¬å¼æ€»ç»“**
| æ­¥éª¤       | æ•°å­¦å…¬å¼                          |
|------------|-----------------------------------|
| æå–è¾¹     | $E = \{(i, j) \mid I_{i,j} \neq \text{é˜ˆå€¼}\}$ |
| ç”Ÿæˆå›¾     | $G = (V, E)$                     |
| æ£€æµ‹ç¯     | è‹¥ $\exists v_1 \to v_2 \to ... \to v_k \to v_1$ï¼Œåˆ™æŠ¥é”™ |

---

## ã€4ã€‘çº¿æ€§å›å½’ï¼ˆLinear Regressionï¼‰æ¨æ–­åŸºç±»

```python
class lr(base):
    """
    ä½¿ç”¨çº¿æ€§å›å½’ï¼ˆLinear Regressionï¼‰è¿›è¡Œç½‘ç»œæ¨æ–­çš„åŸºç±»ã€‚
    """
```

ï¼ˆæœªå®Œå¾…ç»­ï¼‰

---
