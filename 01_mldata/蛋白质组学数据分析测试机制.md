---

### 1. **始终准备小测试数据集**

* 不要直接上几 GB 的真实数据。
* 用 **10–20 条伪造/截取的 peptide 记录**，保证各种情况都出现：

  * 不同 setting（CID25, CID34, HCD22）
  * rank=1 / rank≠1
  * 缺失值（NaN）
  * 不同 charge
* 这样你一跑 compare / match 脚本，就能立刻验证逻辑对不对。

---

### 2. **写断言 / sanity checks**

在脚本里加一些 “防呆”检查，比如：

```python
assert test != "CID34", "Test setting cannot be baseline"
assert out["peptide"].notna().all(), "Peptide column has NaN"
assert (out["precursor_charge"] > 0).all(), "Invalid charges detected"
```

如果有问题，脚本直接报错，比悄悄产出一堆全是 1 的表强多了。

---

### 3. **比对输入和输出数量**

例如：

* `matched` 里 rank=1 的 key 数量 ≈ `compare` 里标记=1 的数量。
* `compare` 输出的行数 ≤ 输入的行数。
  这些都是快速 sanity check。

---

### 4. **单元测试 / 小脚本验证**

可以给函数（比如 `standardize_pep_charge`、`make_setting`）写简单的 pytest，验证：

* "peptide" 列能正确大写化；
* CID25 vs CID34 能正确区分；
* Δlog2 的公式能算出预期结果。

---

### 5. **日志记录**

在 Snakemake 或脚本里，把关键的数量打印出来：

* 输入 peptides 数量
* 输出 Δlog2 数量
* 被标 rank=1 的数量
  这些数字就是“心里有数”的安全感。

---

